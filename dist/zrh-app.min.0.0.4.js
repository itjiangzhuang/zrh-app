/*! zrh-app 08-06-2016 */
var loginCtrl=angular.module("loginCtrl",[]);loginCtrl.controller("LoginCtrl",function($http,$scope,$rootScope,$location,$timeout){$scope.$root.title="登陆",$scope.loginUser={mobile:"",password:""},$scope.error_code_msg={1003:"该用户不存在",2001:"用户名密码错误",1002:"该用户异常",1:"服务器异常,请稍后再试"};var check_params=function(params){return""!=params.mobile&&""!=params.password};$scope.changeErrorMsg=function(msg){$scope.error_msg=msg,$timeout(function(){$scope.error_msg=""},5e3)},$scope.textChange=function(e){$scope.error_msg=""},$scope.loginUser={mobile:"",code:""},$scope.ngBlur=function(){isNullOrEmpty($scope.loginUser.mobile)?($scope.changeErrorMsg("手机号码不能为空"),$("#mobile").focus()):$http({url:api_uri+"api/reg/validateMobile",method:"GET",params:{mobile:$scope.loginUser.mobile}}).success(function(d){1001==d.returnCode?($scope.enableMobile=!0,$scope.success_msg="手机号输入正确"):($scope.enableMobile=!1,$scope.changeErrorMsg("手机号未注册"))}).error(function(d){console.log("login error")})},$scope.login=function(){var m_params=$scope.loginUser;check_params(m_params)&&$http({url:api_uri+"api/auth/web",method:"POST",params:m_params}).success(function(d){if(0==d.returnCode)console.log(d),$rootScope.login_user={userId:d.result.split("_")[0],token:d.result.split("_")[1]},$rootScope.putObject("login_user",$rootScope.login_user),$location.path("/article/list");else{var msg=$scope.error_code_msg[d.returnCode];msg||(msg="登录失败"),$scope.error_msg=msg}}).error(function(d){$scope.changeErrorMsg("网络故障请稍后再试......"),$location.path("/login")})},$scope.register=function(){$location.path("/register/step1")},$scope.reset=function(){$location.path("/register/reset1")}});var registerCtrl=angular.module("registerCtrl",[]);registerCtrl.controller("RegStep1Ctrl",function($http,$scope,$rootScope,$location,$timeout){$scope.registerUser={mobile:"",code:""},$scope.isVerify=!1,$scope.enableMobile=!1,$scope.error_msg="",$("#mobile").focus(),$scope.changeErrorMsg=function(msg){$scope.error_msg=msg,$timeout(function(){$scope.changeErrorMsg("")},5e3)},$scope.sms_second=60,$scope.send_sms=!0,$scope.times=function(){$scope.sms_second>0?($scope.send_sms=!1,$scope.sms_second--,$timeout(function(){$scope.times()},1e3)):$scope.sms_second<=0&&($scope.send_sms=!0,$scope.sms_second=60)},$scope.send_code=function(){isNullOrEmpty($scope.registerUser.mobile)?($scope.changeErrorMsg("手机号码不能为空"),$("#mobile").focus()):$http({url:api_uri+"api/reg/validateMobile",method:"GET",params:{mobile:$scope.registerUser.mobile}}).success(function(d){0==d.returnCode?($scope.enableMobile=!0,$scope.times(),$http({url:api_uri+"api/reg/sendSms",method:"GET",params:{mobile:$scope.registerUser.mobile,token:$rootScope.encryptByDES($scope.registerUser.mobile),timestamp:moment().format("X")}}).success(function(d){0==d.returnCode?$scope.changeErrorMsg("短信验证码已经发送到你的手机"):$scope.changeErrorMsg(d.returnCode)}).error(function(d){console.log("login error")})):($scope.enableMobile=!1,$scope.changeErrorMsg("手机号错误"))}).error(function(d){console.log("login error")})},$scope.changeCode=function(){$scope.enableMobile&&!isNullOrEmpty($scope.registerUser.code)?$scope.isVerify=!0:$scope.isVerify=!1},$scope.validateCode=function(){$scope.isVerify&&$http({url:api_uri+"api/reg/validateSms",method:"POST",params:$scope.registerUser}).success(function(d){0==d.returnCode?$location.path("/register/step2/"+$scope.registerUser.mobile+"/"+d.result):$scope.changeErrorMsg(d.result)}).error(function(d){console.log("login error")})}}),registerCtrl.controller("RegStep2Ctrl",function($http,$scope,$rootScope,$location,$routeParams,$timeout){$scope.registerUser={mobile:$routeParams.mobile,password:"",validatePwd:"",token:$routeParams.token},$scope.changeErrorMsg=function(msg){$scope.error_msg=msg,$timeout(function(){$scope.changeErrorMsg("")},5e3)},$scope.ngBlur=function(){console.log("ng-blur");var reg_str=/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,12}$/;reg_str.test($scope.registerUser.password)||($scope.error_msg="密码必须是6-12位字母+数字")},$scope.textChange=function(e){var reg_str=/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,12}$/;reg_str.test($scope.registerUser.password)?($scope.success_msg="密码格式正确",$scope.error_msg=""):($scope.success_msg="",$scope.error_msg="密码必须是6-12位字母+数字")},$scope.textChange2=function(e){var reg_str=/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,12}$/;$scope.registerUser.password==$scope.registerUser.validatePwd&&reg_str.test($scope.registerUser.password)?($scope.success_msg="点击注册按钮，注册用户",$scope.error_msg=""):($scope.success_msg="",$scope.error_msg="两次输入的密码不一致")},$scope.user_register=function(){var reg_str=/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,12}$/;$scope.registerUser.password==$scope.registerUser.validatePwd&&reg_str.test($scope.registerUser.password)?$http({url:api_uri+"api/reg/regist",method:"POST",params:$scope.registerUser}).success(function(d){0==d.returnCode?(alert("注册成功"),$rootScope.putObject("login_mobile",$scope.registerUser.mobile),$http({url:api_uri+"api/auth/web",method:"POST",params:{mobile:$scope.registerUser.mobile,password:$scope.registerUser.password}}).success(function(d){0==d.returnCode?($rootScope.login_user={userId:d.result.split("_")[0],token:d.result.split("_")[1]},$rootScope.putObject("login_user",$rootScope.login_user),$location.path("/article/list")):($scope.changeErrorMsg(d.result),console.log(d))}).error(function(d){console.log("login error")})):console.log(d)}).error(function(d){console.log("login error")}):$scope.registerUser.password!=$scope.registerUser.validatePwd?$scope.changeErrorMsg("两次密码输入的不一致"):reg_str.test($scope.registerUser.password)||$scope.changeErrorMsg("密码强度不够,必须包含数字和字母")}}),registerCtrl.controller("ResetStep1Ctrl",function($http,$scope,$rootScope,$location,$timeout){$scope.resetUser={mobile:"",code:""},$scope.isVerify=!1,$scope.enableMobile=!1,$scope.error_msg="",$scope.changeErrorMsg=function(msg){$scope.error_msg=msg,$timeout(function(){$scope.changeErrorMsg("")},5e3)},$scope.sms_second=60,$scope.send_sms=!0,$scope.times=function(){$scope.sms_second>0?($scope.send_sms=!1,$scope.sms_second--,$timeout(function(){$scope.times()},1e3)):$scope.sms_second<=0&&($scope.send_sms=!0,$scope.sms_second=60)},$scope.send_code=function(){isNullOrEmpty($scope.resetUser.mobile)?($scope.changeErrorMsg("手机号码不能为空"),$("#mobile").focus()):$http({url:api_uri+"api/reg/validateMobile",method:"GET",params:{mobile:$scope.resetUser.mobile}}).success(function(d){1001==d.returnCode?($scope.enableMobile=!0,$scope.times(),$http({url:api_uri+"api/reg/sendSms2",method:"GET",params:{mobile:$scope.resetUser.mobile,token:$rootScope.encryptByDES($scope.resetUser.mobile),timestamp:moment().format("X")}}).success(function(d){0==d.returnCode?($("#code").focus(),$scope.changeErrorMsg("短信验证码已经发送到你的手机")):$scope.changeErrorMsg(d.result)}).error(function(d){console.log("login error")})):($scope.enableMobile=!1,$scope.changeErrorMsg("手机号错误"))}).error(function(d){console.log("login error")})},$scope.changeCode=function(){$scope.enableMobile&&!isNullOrEmpty($scope.resetUser.code)?$scope.isVerify=!0:$scope.isVerify=!1},$scope.validateCode=function(){$scope.isVerify&&$http({url:api_uri+"api/reg/validateSms",method:"POST",params:$scope.resetUser}).success(function(d){0==d.returnCode?$location.path("/register/reset2/"+$scope.resetUser.mobile+"/"+d.result):$scope.changeErrorMsg(d.result)}).error(function(d){console.log("login error")})}}),registerCtrl.controller("ResetStep2Ctrl",function($http,$scope,$rootScope,$location,$routeParams){$scope.resetUser={mobile:$routeParams.mobile,password:"",validatePwd:"",token:$routeParams.token},$scope.textChange=function(e){var reg_str=/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,12}$/;reg_str.test($scope.resetUser.password)?($scope.success_msg="密码格式正确",$scope.error_msg=""):($scope.success_msg="",$scope.error_msg="密码必须是6-12位字母+数字")},$scope.textChange2=function(e){var reg_str=/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,12}$/;$scope.resetUser.password==$scope.resetUser.validatePwd&&reg_str.test($scope.resetUser.password)?($scope.success_msg="点击重置按钮，重置密码",$scope.error_msg=""):($scope.success_msg="",$scope.error_msg="两次输入的密码不一致")},$scope.user_reset=function(){$http({url:api_uri+"api/reg/reset",method:"POST",params:$scope.resetUser}).success(function(d){0==d.returnCode?(alert("重置密码成功"),$rootScope.putObject("login_mobile",$scope.resetUser.mobile),$http({url:api_uri+"api/auth/web",method:"POST",params:{mobile:$scope.resetUser.mobile,password:$scope.resetUser.password}}).success(function(d){0==d.returnCode?($rootScope.login_user={userId:d.result.split("_")[0],token:d.result.split("_")[1]},$rootScope.putObject("login_user",$rootScope.login_user),$location.path("/article/list")):console.log(d)}).error(function(d){console.log("login error")})):console.log(d)}).error(function(d){console.log("login error")})}});var articleCtrl=angular.module("articleCtrl",[]);articleCtrl.controller("ArticleListCtrl",function($http,$scope,$rootScope,$location){$scope.list=function(){$http({url:api_uri+"api/article/list",method:"GET"}).success(function(d){console.log(d),0==d.returnCode?$scope.result_list=d.result:console.log(d)}).error(function(d){console.log("login error"),$location.path("/error")})},$scope.list(),$scope.article_show=function(id){isNullOrEmpty(id)||$location.path("/article/show/"+id)},$scope.goto_create=function(){$location.path("/article/create/step1")},$scope.goto_center=function(){$location.path("/user/center")}}),articleCtrl.controller("ArticleShowCtrl",function($http,$scope,$rootScope,$location,$routeParams){$scope.init=function(){$scope.bt_show=0,$http({url:api_uri+"api/article/show/"+$routeParams.id,method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?($scope.article=d.result.article,$scope.operate=d.result.operate,$scope.batting=d.result.batting,$scope.step=d.result.step,$scope.step_per=25*$scope.step,0==$scope.step?($scope.operate.admin&&($scope.bt_show=1),$scope.positionText="0",$scope.step_name="未发布"):1==$scope.step?($scope.operate.admin?$scope.bt_show=2:$scope.bt_show=3,$scope.positionText="-20",$scope.step_name="已经发布"):2==$scope.step?($scope.operate.admin?$scope.bt_show=4:$scope.bt_show=5,$scope.positionText="-20",$scope.step_name="竞标中"):3==$scope.step?($scope.operate.admin?$scope.bt_show=4:$scope.bt_show=7,$scope.positionText="-20",$scope.step_name="等待联系"):4==$scope.step&&($scope.operate.admin?$scope.bt_show=4:$scope.bt_show=6,$scope.positionText="-50",$scope.step_name="跟进中")):console.log(d)}).error(function(d){console.log("login error"),$location.path("/error")})},$scope.init(),$scope.release=function(){$.get(api_uri+"api/article/release/"+$routeParams.id,$rootScope.login_user,function(d){0==d.returnCode?($location.path("/article/show/"+d.result),$scope.$apply()):(alert("发布失败,请完善必填项"),console.log(d))},"json")},$scope.next_op=function(op){var obj={update:"/article/update/step1/"+$routeParams.id,bid:"/article/bid/"+$routeParams.id,ask:"/article/questions/"+$routeParams.id+"/"+$rootScope.login_user.userId,bank:"/article/bank/"+$routeParams.id,mobile:"/article/mobile/"+$routeParams.id};$location.path(obj[op])}}),articleCtrl.controller("ArticleCreateStep1Ctrl",function($http,$scope,$rootScope,$location,$routeParams){$scope.create_license=function(){$rootScope.putSessionObject("article",$scope.article),$location.path("/article/license/create")},$scope.getFormToken=function(){$http({url:api_uri+"api/article/formToken",method:"GET",params:$rootScope.login_user}).success(function(d){0==d.returnCode?$scope.article.formToken=d.result:console.log(d)}).error(function(d){console.log("login error")})},$scope.changeLoanValue=function(){$scope.article.loanValue=$("#loanValue").val(),$scope.$apply()},$scope.changeLoanLife=function(){$scope.article.loanLife=$("#loanLife").val(),$scope.$apply()},$scope.changeRateCap=function(){$scope.article.rateCap=$("#rateCap").val(),$scope.$apply()},$scope.changeRateFloor=function(){$scope.article.rateFloor=$("#rateFloor").val(),$scope.$apply()},$scope.init=function(){$scope.article=$rootScope.getSessionObject("article"),$scope.article?($rootScope.removeSessionObject("article"),$scope.article.license||($scope.article.license={})):($scope.article={},$scope.article.license={}),$scope.article.formToken||$scope.getFormToken(),$("#treelist").aomuntmoney(),$("#rate").daterate(),$("#term").dateterm(),$("#term,#rate").click(function(){$("body").css("overflow","hidden")})},$scope.setStyle_div=function(args){return args?"setAfter":"reqName"},$scope.setStyle_div2=function(arg1,arg2){return arg1&&arg2?"setAfter":"reqName"},$scope.init(),$scope.choose_classification=function(){$rootScope.putSessionObject("article",$scope.article),$location.path("/article/classification/create")},$scope.next_step=function(){$rootScope.putSessionObject("article",$scope.article),$location.path("/article/step2")}}),articleCtrl.controller("ArticleLicenseCtrl",function($http,$scope,$rootScope,$location,$routeParams){"create"==$routeParams.op?$scope.article=$rootScope.getSessionObject("article"):"update"==$routeParams.op?$scope.article=$rootScope.getSessionObject("article"):(alert("error op"),$location.path("/article/list")),$scope.changeRegTime=function(){$scope.license.regTime=$("#regTime").val(),$scope.$apply()},$scope.init=function(){$scope.license=$scope.article.license,$scope.license||($scope.license={}),$http({url:api_uri+"api/qiniu/getUpToken",method:"GET",params:$rootScope.login_user}).success(function(d){if(console.log(d),0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.license.licenseImgNames=file.name,$scope.license.licenseImgs=file_url,$scope.$apply()},Error:function(up,err,errTip){console.log(err),$rootScope.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="article/license/"+$rootScope.login_user.userId+"/"+time;return k}}})}else console.log(d)}).error(function(d){console.log(d)}),$("#time").date()},$scope.init(),$scope.setStyle_div=function(args){return args?"setAfter":"reqName"},$scope.choose_type=function(){$scope.article.license=$scope.license,"create"==$routeParams.op?($rootScope.putSessionObject("article",$scope.article),$location.path("/article/businessType/create")):"update"==$routeParams.op&&($rootScope.putSessionObject("article",$scope.article),$location.path("/article/businessType/update"))},$scope.change_time=function(){$scope.license.regTime=$("#time").val()},$scope.sure=function(){$scope.article.license=$scope.license,"create"==$routeParams.op?($rootScope.putSessionObject("article",$scope.article),$location.path("/article/create/step1")):"update"==$routeParams.op&&($rootScope.putSessionObject("article",$scope.article),$location.path("/article/update/step1/"+$scope.article.id))}}),articleCtrl.controller("ArticleStep2Ctrl",function($http,$scope,$rootScope,$location,$routeParams){var pledge=document.getElementById("pledge"),financialInfo=document.getElementById("financialInfo"),advantages=document.getElementById("advantages"),autoTextarea=function(elem,extra,maxHeight){extra=extra||0;var isFirefox=!!document.getBoxObjectFor||"mozInnerScreenX"in window,isOpera=!!window.opera&&!!window.opera.toString().indexOf("Opera"),addEvent=function(type,callback){elem.addEventListener?elem.addEventListener(type,callback,!1):elem.attachEvent("on"+type,callback)},getStyle=elem.currentStyle?function(name){var val=elem.currentStyle[name];if("height"===name&&1!==val.search(/px/i)){var rect=elem.getBoundingClientRect();return rect.bottom-rect.top-parseFloat(getStyle("paddingTop"))-parseFloat(getStyle("paddingBottom"))+"px"}return val}:function(name){return getComputedStyle(elem,null)[name]},minHeight=parseFloat(getStyle("height"));elem.style.resize="none";var change=function(){var scrollTop,height,padding=0,style=elem.style;elem._length!==elem.value.length&&(elem._length=elem.value.length,isFirefox||isOpera||(padding=parseInt(getStyle("paddingTop"))+parseInt(getStyle("paddingBottom"))),scrollTop=document.body.scrollTop||document.documentElement.scrollTop,elem.style.height=minHeight+"px",elem.scrollHeight>minHeight&&(maxHeight&&elem.scrollHeight>maxHeight?(height=maxHeight-padding,style.overflowY="auto"):(height=elem.scrollHeight-padding,style.overflowY="hidden"),style.height=height+extra+"px",scrollTop+=parseInt(style.height)-elem.currHeight,document.body.scrollTop=scrollTop,document.documentElement.scrollTop=scrollTop,elem.currHeight=parseInt(style.height)))};addEvent("propertychange",change),addEvent("input",change),addEvent("focus",change),change()};autoTextarea(pledge),autoTextarea(financialInfo),autoTextarea(advantages),$scope.pledgeTypeList=[{name:"房产",check:!1},{name:"地产",check:!1},{name:"股票",check:!1},{name:"车辆",check:!1},{name:"其他",check:!1}],$scope.setStyle_div=function(args){return args?"setAfter":"reqName"},$scope.check=function(name){for(var i=0;i<$scope.pledgeTypeList.length;i++){var obj=$scope.pledgeTypeList[i];obj.name==name?obj.check?obj.check=!1:(obj.check=!0,$scope.article.pledgeType=obj.name):obj.check=!1}},$scope.init=function(){$scope.article=$rootScope.getSessionObject("article"),$scope.article.pledgeImgs||($scope.article.pledgeImgs=[],$scope.article.pledgeImgNames=[]),$scope.article.financialImgs||($scope.article.financialImgs=[],$scope.article.financialImgNames=[]),$scope.article.advantagesImgs||($scope.article.advantagesImgs=[],$scope.article.advantagesImgNames=[]),$scope.check($scope.article.pledgeType),$http({url:api_uri+"api/qiniu/getUpToken",method:"GET",params:$rootScope.login_user}).success(function(d){if(console.log(d),0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickPledgeImg",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_pledgeImg",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.article.pledgeImgNames.push(file.name),$scope.article.pledgeImgs.push(file_url),$scope.$apply()},Error:function(up,err,errTip){console.log(err),$rootScope.alert("抵押物图片上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="article/pledge/"+$rootScope.login_user.userId+"/"+time;return k}}}),Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickFinancialImg",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_financialImg",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.article.financialImgNames.push(file.name),$scope.article.financialImgs.push(file_url),$scope.$apply()},Error:function(up,err,errTip){console.log(err),$rootScope.alert("财务信息上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="article/financial/"+$rootScope.login_user.userId+"/"+time;return k}}}),Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickAdvantagesImg",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_advantagesImg",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.article.advantagesImgNames.push(file.name),$scope.article.advantagesImgs.push(file_url),$scope.$apply()},Error:function(up,err,errTip){console.log(err),$rootScope.alert("公司优势资料上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="article/advantages/"+$rootScope.login_user.userId+"/"+time;return k}}})}else console.log(d)}).error(function(d){console.log(d)})},$scope.removePledgeImg=function(index){$scope.article.pledgeImgNames.splice(index,1),$scope.article.pledgeImgs.splice(index,1)},$scope.removeFinancialImg=function(index){$scope.article.financialImgNames.splice(index,1),$scope.article.financialImgs.splice(index,1)},$scope.removeAdvantagesImg=function(index){$scope.article.advantagesImgNames.splice(index,1),$scope.article.advantagesImgs.splice(index,1)},$scope.init(),$scope.choose_credit=function(){$rootScope.putSessionObject("article",$scope.article),$location.path("/article/credit")},$scope.validate_params=function(){var params={id:$scope.article.id,userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,formToken:$scope.article.formToken};return isNullOrEmpty($scope.article.loanValue)||(params.loanValue=$scope.article.loanValue),isNullOrEmpty($scope.article.loanLife)||(params.loanLife=$scope.article.loanLife),isNullOrEmpty($scope.article.rateCap)||(params.rateCap=$scope.article.rateCap),isNullOrEmpty($scope.article.rateFloor)||(params.rateFloor=$scope.article.rateFloor),isNullOrEmpty($scope.article.classification)||(params.classification=$scope.article.classification),isNullOrEmpty($scope.article.license.businessName)?(alert("请完善公司名称"),$scope.create_license()):params.businessName=$scope.article.license.businessName,isNullOrEmpty($scope.article.license.regTime)||(params.regTime=$scope.article.license.regTime),isNullOrEmpty($scope.article.license.businessType)||(params.businessType=$scope.article.license.businessType),isNullOrEmpty($scope.article.license.regFunds)||(params.regFunds=$scope.article.license.regFunds),isNullOrEmpty($scope.article.license.licenseImgs)||(params.licenseImgs=$scope.article.license.licenseImgs,params.licenseImgNames=$scope.article.license.licenseImgNames),isNullOrEmpty($scope.article.license.corporateRepresentative)||(params.corporateRepresentative=$scope.article.license.corporateRepresentative),isNullOrEmpty($scope.article.pledgeType)||(params.pledgeType=$scope.article.pledgeType),isNullOrEmpty($scope.article.pledge)||(params.pledge=$scope.article.pledge),isNullOrEmpty($scope.article.pledgeImgs)||(params.pledgeImgs=$scope.article.pledgeImgs.join(","),params.pledgeImgNames=$scope.article.pledgeImgNames.join(",")),isNullOrEmpty($scope.article.credit)||(params.credit=$scope.article.credit),isNullOrEmpty($scope.article.financialInfo)||(params.financialInfo=$scope.article.financialInfo),isNullOrEmpty($scope.article.financialImgs)||(params.financialImgs=$scope.article.financialImgs.join(","),params.financialImgNames=$scope.article.financialImgNames.join(",")),isNullOrEmpty($scope.article.continualOperateYear)||(params.continualOperateYear=$scope.article.continualOperateYear),isNullOrEmpty($scope.article.continualPublicYear)||(params.continualPublicYear=$scope.article.continualPublicYear),isNullOrEmpty($scope.article.businessContact)||(params.businessContact=$scope.article.businessContact),isNullOrEmpty($scope.article.corporateResidence)||(params.corporateResidence=$scope.article.corporateResidence),isNullOrEmpty($scope.article.advantages)||(params.advantages=$scope.article.advantages),isNullOrEmpty($scope.article.advantagesImgs)||(params.advantagesImgs=$scope.article.advantagesImgs.join(","),params.advantagesImgNames=$scope.article.advantagesImgNames.join(",")),params},$scope.save=function(){var params=$scope.validate_params();$.post(api_uri+"api/article/save",params,function(data){0==data.returnCode?($rootScope.removeSessionObject("article"),$location.path("/article/show/"+data.result),$scope.$apply()):console.log(data)},"json")},$scope.release=function(){var params=$scope.validate_params();console.log(params),$.post(api_uri+"api/article/save",params,function(data){0==data.returnCode?($rootScope.removeSessionObject("article"),$.get(api_uri+"api/article/release/"+data.result,$rootScope.login_user,function(d){0==data.returnCode?($location.path("/article/show/"+data.result),$scope.$apply()):(alert("发布失败,请完善必填项"),console.log(d))},"json")):console.log(data)},"json")}}),articleCtrl.controller("CreditCtrl",function($http,$scope,$rootScope,$location,$routeParams){$scope.article=$rootScope.getSessionObject("article"),$scope.article||($scope.article={}),$scope.obj_list=[{name:"不限",check:!1},{name:"信用贷款",check:!1},{name:"固定资产贷款",check:!1},{name:"流动资产贷款",check:!1},{name:"经营性物业贷款",check:!1},{name:"房地产开发贷款",check:!1}],$scope.check=function(name){for(var i=0;i<$scope.obj_list.length;i++){var obj=$scope.obj_list[i];obj.name==name?obj.check?obj.check=!1:obj.check=!0:obj.check=!1}},$scope.check($scope.article.credit),$scope.sure=function(){$scope.article.credit="";for(var i=0;i<$scope.obj_list.length;i++){var obj=$scope.obj_list[i];obj.check&&($scope.article.credit=obj.name)}$rootScope.putSessionObject("article",$scope.article),$location.path("/article/step2")}}),articleCtrl.controller("ClassificationCtrl",function($http,$scope,$rootScope,$location,$routeParams){"create"==$routeParams.op?$scope.article=$rootScope.getSessionObject("article"):"update"==$routeParams.op?$scope.article=$rootScope.getSessionObject("article"):(alert("error op"),$location.path("/article/list")),$scope.obj_list=[{name:"大农业",check:!1},{name:"房地产",check:!1},{name:"商业贸易",check:!1},{name:"仓储物流",check:!1},{name:"工业制造",check:!1},{name:"医疗",check:!1},{name:"教育",check:!1},{name:"建筑工程",check:!1},{name:"电子商务",check:!1}],$scope.check=function(name){for(var i=0;i<$scope.obj_list.length;i++){var obj=$scope.obj_list[i];obj.name==name?obj.check?obj.check=!1:obj.check=!0:obj.check=!1}},$scope.check($scope.article.classification),$scope.sure=function(){$scope.article.classification="";for(var i=0;i<$scope.obj_list.length;i++){var obj=$scope.obj_list[i];obj.check&&($scope.article.classification=obj.name)}"create"==$routeParams.op?($rootScope.putSessionObject("article",$scope.article),$location.path("/article/create/step1")):"update"==$routeParams.op&&($rootScope.putSessionObject("article",$scope.article),$location.path("/article/update/step1/"+$scope.article.id))}}),articleCtrl.controller("BusinessTypeCtrl",function($http,$scope,$rootScope,$location,$routeParams){"create"==$routeParams.op?$scope.article=$rootScope.getSessionObject("article"):"update"==$routeParams.op?$scope.article=$rootScope.getSessionObject("article"):(alert("error op"),$location.path("/article/list")),$scope.obj_list=[{name:"个人独资企业",check:!1},{name:"合伙企业",check:!1},{name:"有限责任公司",check:!1},{name:"股份制有限公司",check:!1}],$scope.check=function(name){for(var i=0;i<$scope.obj_list.length;i++){var obj=$scope.obj_list[i];obj.name==name?obj.check?obj.check=!1:obj.check=!0:obj.check=!1}},$scope.check($scope.article.license.businessType),$scope.sure=function(){$scope.article.license.businessType="";for(var i=0;i<$scope.obj_list.length;i++){var obj=$scope.obj_list[i];obj.check&&($scope.article.license.businessType=obj.name)}"create"==$routeParams.op?($rootScope.putSessionObject("article",$scope.article),$location.path("/article/license/create")):"update"==$routeParams.op&&($rootScope.putSessionObject("article",$scope.article),$location.path("/article/license/update"))}}),articleCtrl.controller("ArticleUpdateStep1Ctrl",function($http,$scope,$rootScope,$location,$routeParams){params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token},$scope.init=function(){$routeParams.id&&!isNullOrEmpty($routeParams.id)||$location.path("/article/list"),$scope.article=$rootScope.getSessionObject("article"),$scope.article?$rootScope.removeSessionObject("article"):(params.id=$routeParams.id,$http({url:api_uri+"api/article/update",method:"GET",params:params}).success(function(data){0==data.returnCode?($scope.article=data.result,$scope.article.licenseImg&&($scope.article.license.licenseImgs=$scope.article.licenseImg,$scope.article.license.licenseImgNames=$scope.article.licenseImgName),$scope.article.financialImg&&($scope.article.financialImgs=$scope.article.financialImg,$scope.article.financialImgNames=$scope.article.financialImgName),$scope.article.pledgeImg&&($scope.article.pledgeImgs=$scope.article.pledgeImg,$scope.article.pledgeImgNames=$scope.article.pledgeImgName),$scope.article.advantagesImg&&($scope.article.advantagesImgs=$scope.article.advantagesImg,$scope.article.advantagesImgNames=$scope.article.advantagesImgName)):console.log(data)}).error(function(d){console.log("login error")})),$("#treelist").aomuntmoney(),$("#rate").daterate(),$("#term").dateterm(),$("#term,#rate").click(function(){$("body").css("overflow","hidden")})},$scope.changeLoanValue=function(){$scope.article.loanValue=$("#loanValue").val(),$scope.$apply()},$scope.changeLoanLife=function(){$scope.article.loanLife=$("#loanLife").val(),$scope.$apply()},$scope.changeRateCap=function(){$scope.article.rateCap=$("#rateCap").val(),$scope.$apply()},$scope.changeRateFloor=function(){$scope.article.rateFloor=$("#rateFloor").val(),$scope.$apply()},$scope.setStyle_div=function(args){return args?"setAfter":"reqName"},$scope.setStyle_div2=function(arg1,arg2){return arg1&&arg2?"setAfter":"reqName"},$scope.init(),$scope.choose_classification=function(){$rootScope.putSessionObject("article",$scope.article),$location.path("/article/classification/update")},$scope.create_license=function(){$rootScope.putSessionObject("article",$scope.article),$location.path("/article/license/update")},$scope.next_step=function(){$rootScope.putSessionObject("article",$scope.article),$location.path("/article/step2")}}),articleCtrl.controller("QuestionsCtrl",function($http,$scope,$rootScope,$location,$routeParams,$timeout,$interval){var ibc=$(window).height()-253;$(".displayFrame").css("height",ibc+"px");var content=document.getElementById("content"),autoTextarea=function(elem,extra,maxHeight){extra=extra||0;var isFirefox=!!document.getBoxObjectFor||"mozInnerScreenX"in window,isOpera=!!window.opera&&!!window.opera.toString().indexOf("Opera"),addEvent=function(type,callback){elem.addEventListener?elem.addEventListener(type,callback,!1):elem.attachEvent("on"+type,callback)},getStyle=elem.currentStyle?function(name){var val=elem.currentStyle[name];if("height"===name&&1!==val.search(/px/i)){var rect=elem.getBoundingClientRect();return rect.bottom-rect.top-parseFloat(getStyle("paddingTop"))-parseFloat(getStyle("paddingBottom"))+"px"}return val}:function(name){return getComputedStyle(elem,null)[name]},minHeight=parseFloat(getStyle("height"));elem.style.resize="none";var change=function(){var scrollTop,height,padding=0,style=elem.style;elem._length!==elem.value.length&&(elem._length=elem.value.length,isFirefox||isOpera||(padding=parseInt(getStyle("paddingTop"))+parseInt(getStyle("paddingBottom"))),scrollTop=document.body.scrollTop||document.documentElement.scrollTop,elem.style.height=minHeight+"px",elem.scrollHeight>minHeight&&(maxHeight&&elem.scrollHeight>maxHeight?(height=maxHeight-padding,style.overflowY="auto"):(height=elem.scrollHeight-padding,style.overflowY="hidden"),style.height=height+extra+"px",scrollTop+=parseInt(style.height)-elem.currHeight,document.body.scrollTop=scrollTop,document.documentElement.scrollTop=scrollTop,elem.currHeight=parseInt(style.height)))};addEvent("propertychange",change),addEvent("input",change),addEvent("focus",change),
change()};autoTextarea(content),$scope.init=function(){var lastTime=$rootScope.getObject("lt_"+$routeParams.id+"_"+$routeParams.userId);lastTime||$rootScope.putObject("lt_"+$routeParams.id+"_"+$routeParams.userId,0),$http({url:api_uri+"api/article/showTitle/"+$routeParams.id,method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?($scope.article=d.result.article,$scope.batting=d.result.batting):console.log(d)}).error(function(d){console.log("login error")}),$http({url:api_uri+"api/articleComments/list/"+$routeParams.id+"/"+$routeParams.userId,method:"GET",params:{userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,lastTime:0}}).success(function(d){console.log(d),0==d.returnCode?$scope.message_list=d.result:console.log(d)}).error(function(d){console.log(d)}),$scope.message_list&&$scope.message_list.length>0?$rootScope.putObject("lt_"+$routeParams.id+"_"+$routeParams.userId,$scope.message_list[$scope.message_list.length-1].createTime):$scope.message_list=[],$scope.otherList()},$scope.otherList=function(){$http({url:api_uri+"api/articleComments/otherList/"+$routeParams.id+"/"+$routeParams.userId,method:"GET",params:{userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,lastTime:$rootScope.getObject("lt_"+$routeParams.id+"_"+$routeParams.userId)}}).success(function(d){if(0==d.returnCode){if($scope.other_list=d.result,$scope.other_list&&$scope.other_list.length>0){$rootScope.putObject("lt_"+$routeParams.id+"_"+$routeParams.userId,$scope.other_list[$scope.other_list.length-1].createTime);for(var i=0;i<$scope.other_list.length;i++)$scope.message_list.push($scope.other_list[i])}}else console.log(d);$scope.otherList()}).error(function(d){console.log(d)})},$scope.sendMessage=function(){var content=$("#content").val();$("#content").val(""),params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,content:content},$.post(api_uri+"api/articleComments/leave/"+$routeParams.id+"/"+$routeParams.userId,params,function(data){if(0==data.returnCode){console.log("发送成功");var _scroll=$(".displayFrame")[0].scrollHeight;$(".displayFrame").animate({scrollTop:_scroll},500)}else console.log("发送失败"),console.log(data)},"json");var contentObj={self:!0,comment:content};$scope.message_list.push(contentObj)},$scope.init()}),articleCtrl.controller("ArticleBidCtrl",function($http,$scope,$rootScope,$location,$routeParams){$scope.init=function(){$scope.title="提示",$scope.content="申请中,请稍后......",$scope.return_url="/article/show/"+$routeParams.id,$http({url:api_uri+"api/articleUser/bid/"+$routeParams.id,method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?($scope.title="已竞标",$scope.content="竞标申请成功,等待项目方确认"):($scope.title="已竞标",$scope.content=d.result,console.log(d))}).error(function(d){console.log(d)})},$scope.init(),$scope.sure=function(){$location.path($scope.return_url)}}),articleCtrl.controller("ArticleMobileCtrl",function($http,$scope,$rootScope,$location,$routeParams){$scope.init=function(){$http({url:api_uri+"api/article/mobile/"+$routeParams.id,method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?$scope.linkman=d.result:console.log(d)}).error(function(d){console.log(d)})},$scope.init(),$scope.sure=function(){}}),articleCtrl.controller("ArticleBankCtrl",function($http,$scope,$rootScope,$location,$routeParams){$scope.init=function(){$http({url:api_uri+"api/article/bank/"+$routeParams.id,method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?$scope.bank_list=d.result:console.log(d)}).error(function(d){console.log(d)})},$scope.init(),$scope.sure=function(){}});var userCtrl=angular.module("userCtrl",[]);userCtrl.controller("UserCenterCtrl",function($http,$scope,$rootScope,$location){$scope.init=function(){$http({url:api_uri+"api/user/center",method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?($scope.nickname=d.result.nickname,$scope.isVip=d.result.isVip,$scope.batting=d.result.batting,$scope.ms=d.result.ms,$scope.cs=d.result.cs,$scope.headImg=d.result.headImg):console.log(d)}).error(function(d){console.log(d)})},$scope.next_op=function(op){var obj={questions:"/user/questions",messages:"/user/messages",projectManage:"/article/projectManage",projectInvest:"/article/projectInvest",applyInvest:"/user/applyInvest",myWallet:"/user/wallet",setting:"/user/setting",goto_create:"/article/create/step1",goto_list:"/article/list"};$location.path(obj[op])},$scope.show=function(articleId,toUser){$location.path("/article/questions/"+articleId+"/"+toUser),$scope.names=2,$scope.vipToCommon=function(){1==$scope.names&&($(".vipHave").css("display","none"),$(".vipNone").css("display","block"))}},$scope.init()}),userCtrl.controller("MyQuestionsCtrl",function($http,$scope,$rootScope,$location){$scope.init=function(){$http({url:api_uri+"api/articleComments/lastList",method:"GET",params:{userId:$rootScope.login_user.userId,token:$rootScope.login_user.token}}).success(function(d){if(console.log(d),0==d.returnCode){$scope.obj_list=d.result;for(var i=0;i<$scope.obj_list.length;i++)$scope.obj_list[i].time=moment.unix($scope.obj_list[i].lastUpdateTime/1e3).format("YYYY.MM.DD")}else console.log(d)}).error(function(d){console.log(d)})},$scope.show=function(articleId,toUser){$location.path("/article/questions/"+articleId+"/"+toUser)},$scope.init()}),userCtrl.controller("ProjectManageCtrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.init=function(){$scope.border=!0,$scope.type||($scope.type="1"),$http({url:api_uri+"api/article/myList",method:"GET",params:{userId:$rootScope.login_user.userId,token:$rootScope.login_user.token,type:$scope.type}}).success(function(d){0==d.returnCode?($scope.obj_list=d.result,angular.forEach($scope.obj_list,function(data){0==$scope.type?(data.jindu="0",data.jindushow="未发布",data.jinduShowM="0"):1==$scope.type&&((data.jd=0)?(data.jindu="10",data.jindushow="已经发布",data.jinduShowM="-20"):(data.jd=1)?(console.log("11111111111"),data.jindu="30",data.jindushow="等待联系",data.jinduShowM="-20"):(data.jd=2)?(data.jindu="50",data.jindushow="跟进中",data.jinduShowM="-20"):(data.jd=3)?(data.jindu="100",data.jindushow="签约成功",data.jinduShowM="-50"):(data.jd=-2)&&(data.jindu="0",data.jindushow="签约失败",data.jinduShowM="0"))})):console.log(d)}).error(function(d){console.log(d)})},$scope.init(),$scope.article_show=function(id){isNullOrEmpty(id)||$location.path("/article/show/"+id)},$scope.unRelease=function(){$scope.type="0",$scope.init(),$scope.border=!1,$scope.noBorder=!0},$scope.release=function(){$scope.type="1",$scope.init(),$scope.border=!0,$scope.noBorder=!1},$scope.release()}]),userCtrl.controller("ProjectInvestCtrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.init=function(){$http({url:api_uri+"api/article/investList",method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?($scope.obj_list=d.result,angular.forEach($scope.obj_list,function(data){(data.jd=0)?(data.jindu="10",data.jindushow="竞标中"):(data.jd=1)?(data.jindu="30",data.jindushow="约见信息"):(data.jd=2)?(data.jindu="50",data.jindushow="跟进中"):(data.jd=3)?(data.jindu="100",data.jindushow="签约成功"):(data.jd=-1)?(data.jindu="0",data.jindushow="竞标失败"):(data.jd=-2)&&(data.jindu="0",data.jindushow="签约失败")})):console.log(d)}).error(function(d){console.log(d)})},$scope.init(),$scope.article_show=function(id){isNullOrEmpty(id)||$location.path("/article/show/"+id)}}]),userCtrl.controller("ApplyInvestCtrl",function($http,$scope,$rootScope,$location){$scope.init=function(){$http({url:api_uri+"api/user/showIq",method:"GET",params:{userId:$rootScope.login_user.userId,token:$rootScope.login_user.token}}).success(function(d){console.log(d),0==d.returnCode?($scope.userApplyInvest=d.result,$scope.userApplyInvest||($scope.userApplyInvest={})):console.log(d)}).error(function(d){console.log(d)}),$http({url:api_uri+"api/qiniu/getUpToken",method:"GET",params:$rootScope.login_user}).success(function(d){if(console.log(d),0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){},UploadProgress:function(up,file){},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.userApplyInvest.cardImg=file_url,$scope.$apply()},Error:function(up,err,errTip){console.log(err),$rootScope.alert("身份证上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="user/card/"+$rootScope.login_user.userId+"/"+time;return k}}})}else console.log(d)}).error(function(d){console.log(d)})},$scope.init(),$scope.apply=function(){$scope.isApply=!0;var params={userId:$rootScope.login_user.userId,token:$rootScope.login_user.token};isNullOrEmpty($scope.userApplyInvest.name)||(params.name=$scope.userApplyInvest.name),isNullOrEmpty($scope.userApplyInvest.orgName)||(params.orgName=$scope.userApplyInvest.orgName),isNullOrEmpty($scope.userApplyInvest.position)||(params.position=$scope.userApplyInvest.position),isNullOrEmpty($scope.userApplyInvest.cardImg)||(params.cardImg=$scope.userApplyInvest.cardImg),$.post(api_uri+"api/user/applyIq",params,function(data){0==data.returnCode?(alert("提交成功,请等待审核..."),$scope.next=!0,$location.path("/user/center")):console.log(data),$scope.isApply=!1,console.log(" isApply :"+$scope.isApply),$scope.$apply()},"json")}}),userCtrl.controller("SettingCtrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.init=function(){$http({url:api_uri+"api/user/setting",method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d),0==d.returnCode?$scope.user=d.result:console.log(d)}).error(function(d){console.log(d)}),$http({url:api_uri+"api/qiniu/getUpToken",method:"GET",params:$rootScope.login_user}).success(function(d){if(console.log(d),0==d.returnCode){$scope.qiniu_token=d.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:$scope.qiniu_token,domain:$rootScope.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(up,files){},BeforeUpload:function(up,file){$rootScope.uploading=!0,$scope.upload_percent=file.percent,$rootScope.$apply()},UploadProgress:function(up,file){$scope.upload_percent=file.percent,$scope.$apply()},FileUploaded:function(up,file,info){var res=$.parseJSON(info),file_url="http://"+$rootScope.qiniu_bucket_domain+"/"+res.key;$scope.user.headImg=file_url,$scope.$apply();var params=$rootScope.login_user;params.key="headImg",params.value=$scope.user.headImg,$.post(api_uri+"api/user/update",params,function(data){0==data.returnCode||console.log(data)},"json")},Error:function(up,err,errTip){console.log(err),$rootScope.alert("营业执照上传失败！")},UploadComplete:function(){},Key:function(up,file){var time=(new Date).getTime(),k="user/headImg/"+$rootScope.login_user.userId+"/"+time;return k}}})}else console.log(d)}).error(function(d){console.log(d)})},$scope.init(),$scope.reset=function(){$location.path("/register/reset1")},$scope.update=function(key,value){isNullOrEmpty(key)||(isNullOrEmpty(value)&&(value=""),$rootScope.putSessionObject("user_update",key+"="+value),$location.path("/user/update"))},$scope.logout=function(){$http({url:api_uri+"api/auth/logout",method:"GET",params:$rootScope.login_user}).success(function(d){console.log(d)}).error(function(d){console.log(d)}),$rootScope.removeObject("login_user",$rootScope.login_user),$rootScope.login_user={},$location.path("/login")}}]),userCtrl.controller("WalletCtrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.wallet_list=[{className:"平安银行",cardId:"1234567899876543219",classification:"储蓄卡"},{className:"平安银行",cardId:"1234567899876543219",classification:"储蓄卡"},{className:"平安银行",cardId:"1234567899876543219",classification:"储蓄卡"}],$scope.addCard=function(){$location.path("/user/bankCard")}}]),userCtrl.controller("UserUpdateCtrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.init=function(){var user_update=$rootScope.getSessionObject("user_update");user_update&&user_update.indexOf("=")&&($rootScope.removeObject("user_update"),$scope.update_user={},$scope.update_user.key=user_update.split("=")[0],$scope.update_user.value=user_update.split("=")[1])},$scope.init(),$scope.sure=function(){var params=$rootScope.login_user;params.key=$scope.update_user.key,params.value=$scope.update_user.value,console.log(params);var keys=["name","email"];$.inArray(params.key,keys)>=0&&$.post(api_uri+"api/user/update",params,function(data){0==data.returnCode||console.log(data)},"json"),$location.path("/user/setting")},$scope.checkEmail=function(){var reg=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;reg.test($scope.update_user.value)?$scope.sure():$scope.error_msg="邮箱格式不正确"}}]);var bankCardCtrl=angular.module("bankCardCtrl",[]);bankCardCtrl.controller("addBankCardCtrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.getSRF=function(){$(document).ready(function(){$("input[name=demo]").focus()})},$scope.cardPassword="",$scope.getSRF(),$scope.change=function(){console.log($scope.cardPassword),6==$scope.cardPassword.length&&$location.path("/user/bankCard2")}}]),bankCardCtrl.controller("addBankCard2Ctrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.alertTip=function(){$(".coverAlert").css("display","block")},$scope.exitAlertTip=function(){$(".coverAlert").css("display","none")},$scope.next_step=function(){11==Scope.phoneNum&&$location.path("/wallet/createCard3")}}]),api_uri="http://zrh.supeiyunjing.com/",templates_root="templates/",deskey="abc123.*abc123.*abc123.*abc123.*";var myApp=angular.module("myApp",["ng","ngRoute","ngAnimate","loginCtrl","registerCtrl","articleCtrl","userCtrl","bankCardCtrl"],function($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",$httpProvider.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8"});myApp.run(["$location","$rootScope","$http",function($location,$rootScope,$http){$rootScope.qiniu_bucket_domain="o793l6o3p.bkt.clouddn.com",$rootScope.$on("$routeChangeSuccess",function(event,current,previous){}),$rootScope.$on("$routeChangeStart",function(event,current,previous){var present_route=$location.$$path,routes=["/login","/article/list"];if(!$rootScope.login_user){var register_reg=/\/register.*/;register_reg.test(present_route)||routes.indexOf(present_route)>-1||$location.path("/login")}}),$rootScope.putObject=function(key,value){localStorage.setItem(key,angular.toJson(value))},$rootScope.getObject=function(key){return angular.fromJson(localStorage.getItem(key))},$rootScope.removeObject=function(key){localStorage.removeItem(key)},$rootScope.putSessionObject=function(key,value){sessionStorage.setItem(key,angular.toJson(value))},$rootScope.getSessionObject=function(key){return angular.fromJson(sessionStorage.getItem(key))},$rootScope.removeSessionObject=function(key){angular.fromJson(sessionStorage.removeItem(key))},$rootScope.encryptByDES=function(message){var keyHex=CryptoJS.enc.Utf8.parse(deskey),encrypted=CryptoJS.DES.encrypt(message,keyHex,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return encrypted.toString()},$rootScope.decryptByDES=function(ciphertext){var keyHex=CryptoJS.enc.Utf8.parse(deskey),decrypted=CryptoJS.DES.decrypt({ciphertext:CryptoJS.enc.Base64.parse(ciphertext)},keyHex,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return decrypted.toString(CryptoJS.enc.Utf8)},$rootScope.transFn=function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&").toString()},$rootScope.close_alert=function(){$rootScope.alert_show=null},$rootScope.alert=function(data){$rootScope.alert_show=!0,data?($rootScope.alert_str=data,setTimeout(function(){$rootScope.alert_show=null,$rootScope.$apply()},3e3)):$rootScope.alert_str="未知错误"},$rootScope.check_user=function(){return $rootScope.login_user=$rootScope.getObject("login_user"),$rootScope.login_user?void $http({url:api_uri+"api/auth/validateAuth",method:"POST",params:$rootScope.login_user}).success(function(d){return 0==d.returnCode?(console.log("login success"),!0):($rootScope.login_user={},$rootScope.removeObject("login_user"),!1)}).error(function(d){return $rootScope.removeObject("login_user"),!1}):($rootScope.removeObject("login_user"),!1)},window.localStorage||alert("This browser does NOT support localStorage"),window.sessionStorage||alert("This browser does NOT support sessionStorage"),$rootScope.check_user()}]),myApp.config(function($routeProvider){$routeProvider.when("/login",{templateUrl:templates_root+"login/login.html",controller:"LoginCtrl"}).when("/register/step1",{templateUrl:templates_root+"register/step1.html",controller:"RegStep1Ctrl"}).when("/register/step2/:mobile/:token",{templateUrl:templates_root+"register/step2.html",controller:"RegStep2Ctrl"}).when("/register/reset1",{templateUrl:templates_root+"register/reset1.html",controller:"ResetStep1Ctrl"}).when("/register/reset2/:mobile/:token",{templateUrl:templates_root+"register/reset2.html",controller:"ResetStep2Ctrl"}).when("/article/list",{templateUrl:templates_root+"article/list.html",controller:"ArticleListCtrl"}).when("/article/show/:id",{templateUrl:templates_root+"article/show.html",controller:"ArticleShowCtrl"}).when("/article/create/step1",{templateUrl:templates_root+"article/step1.html",controller:"ArticleCreateStep1Ctrl"}).when("/article/update/step1/:id",{templateUrl:templates_root+"article/step1.html",controller:"ArticleUpdateStep1Ctrl"}).when("/article/license/:op",{templateUrl:templates_root+"article/license.html",controller:"ArticleLicenseCtrl"}).when("/article/step2",{templateUrl:templates_root+"article/step2.html",controller:"ArticleStep2Ctrl"}).when("/article/credit",{templateUrl:templates_root+"article/select.html",controller:"CreditCtrl"}).when("/article/classification/:op",{templateUrl:templates_root+"article/select.html",controller:"ClassificationCtrl"}).when("/article/businessType/:op",{templateUrl:templates_root+"article/select.html",controller:"BusinessTypeCtrl"}).when("/article/questions/:id/:userId",{templateUrl:templates_root+"article/questions.html",controller:"QuestionsCtrl"}).when("/user/center",{templateUrl:templates_root+"user/center.html",controller:"UserCenterCtrl"}).when("/user/questions",{templateUrl:templates_root+"user/myquestions.html",controller:"MyQuestionsCtrl"}).when("/user/messages",{templateUrl:templates_root+"user/my_message.html",controller:"MyMessages"}).when("/user/wallet",{templateUrl:templates_root+"user/wallet.html",controller:"WalletCtrl"}).when("/user/bankCard",{templateUrl:templates_root+"add_bankcard/add_bankcard.html",controller:"addBankCardCtrl"}).when("/user/bankCard2",{templateUrl:templates_root+"add_bankcard/add_bankcard2.html",controller:"addBankCard2Ctrl"}).when("/user/setting",{templateUrl:templates_root+"user/setting.html",controller:"SettingCtrl"}).when("/user/applyInvest",{templateUrl:templates_root+"user/apply_invest.html",controller:"ApplyInvestCtrl"}).when("/article/projectManage",{templateUrl:templates_root+"user/project_manage.html",controller:"ProjectManageCtrl"}).when("/article/projectInvest",{templateUrl:templates_root+"user/project_invest.html",controller:"ProjectInvestCtrl"}).when("/article/bid/:id",{templateUrl:templates_root+"article/alert.html",controller:"ArticleBidCtrl"}).when("/article/mobile/:id",{templateUrl:templates_root+"article/mobile.html",controller:"ArticleMobileCtrl"}).when("/article/bank/:id",{templateUrl:templates_root+"article/bank.html",controller:"ArticleBankCtrl"}).when("/user/update",{templateUrl:templates_root+"user/update.html",controller:"UserUpdateCtrl"}).when("/error",{templateUrl:templates_root+"404.html"}).otherwise({redirectTo:"/article/list"})});